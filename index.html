<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frames by Arju</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade { animation: fadeIn 2s ease-in-out; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-black text-white">

    <div id="loader" class="fixed inset-0 flex items-center justify-center bg-black z-50">
        <h1 class="text-3xl md:text-5xl font-bold animate-fade text-orange-500 tracking-tighter">FRAMES BY ARJU</h1>
    </div>

    <div id="app" class="hidden p-4">
        <header class="text-center mb-8">
            <h2 class="text-xl font-light tracking-widest uppercase">Gallery</h2>
            <div id="admin-panel" class="hidden mt-5 p-4 border border-dashed border-gray-600 rounded">
                <p class="text-xs text-gray-400 mb-2 font-bold uppercase">Admin Panel</p>
                <div id="status" class="text-orange-500 text-[10px] mb-2"></div>
                <input type="file" id="file-input" multiple accept="image/*" class="hidden">
                <button onclick="document.getElementById('file-input').click()" class="bg-white text-black px-4 py-2 rounded text-sm font-bold">ADD PHOTOS</button>
                <button id="qr-gen-btn" onclick="toggleQR()" class="bg-orange-600 px-4 py-2 rounded text-sm font-bold ml-2">GENERATE QR</button>
                <button onclick="clearGallery()" class="bg-red-600 px-4 py-2 rounded text-sm font-bold ml-2">CLEAR ALL</button>
            </div>
        </header>

        <div id="qr-box" class="hidden bg-white p-4 rounded-lg mx-auto max-w-[250px] text-center mb-8">
            <div id="qrcode" class="flex justify-center"></div>
            <p class="text-black text-[10px] mt-2 font-bold uppercase">Scan to share</p>
        </div>

        <div class="flex justify-between items-center mb-4">
            <span id="photo-count" class="text-xs text-gray-400">0 Photos</span>
            <button onclick="downloadAllZip()" class="bg-green-600 text-[10px] px-3 py-1 rounded-full font-bold">DOWNLOAD ALL (ZIP)</button>
        </div>

        <div id="gallery" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
    </div>

    <script>
        // --- YOUR CLOUDINARY CONFIG ---
        const CLOUD_NAME = "dlgrj339z";
        const UPLOAD_PRESET = "Aj wedding"; 

        let photos = JSON.parse(localStorage.getItem('arju_photos')) || [];
        const urlParams = new URLSearchParams(window.location.search);
        const isAdmin = urlParams.get('admin') === 'true';

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('app').classList.remove('hidden');
                if(isAdmin) document.getElementById('admin-panel').classList.remove('hidden');
                renderGallery();
            }, 2500);
        };

        document.getElementById('file-input').addEventListener('change', async function(e) {
            const files = Array.from(e.target.files);
            const status = document.getElementById('status');
            
            for (let i = 0; i < files.length; i++) {
                status.innerText = `Uploading ${i+1}/${files.length}...`;
                const formData = new FormData();
                formData.append('file', files[i]);
                formData.append('upload_preset', UPLOAD_PRESET);

                try {
                    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    const data = await res.json();
                    if(data.secure_url) {
                        photos.push(data.secure_url);
                        saveAndRender();
                    }
                } catch (err) {
                    console.error("Upload failed");
                }
            }
            status.innerText = "Upload Complete!";
            setTimeout(() => status.innerText = "", 3000);
        });

        function saveAndRender() {
            localStorage.setItem('arju_photos', JSON.stringify(photos));
            renderGallery();
        }

        function renderGallery() {
            const gallery = document.getElementById('gallery');
            document.getElementById('photo-count').innerText = `${photos.length} Photos`;
            gallery.innerHTML = "";
            photos.forEach((src, index) => {
                const div = document.createElement('div');
                div.className = "relative aspect-square rounded-lg overflow-hidden bg-gray-900 shadow-lg";
                div.innerHTML = `
                    <img src="${src}" class="w-full h-full object-cover" onclick="window.open('${src}', '_blank')">
                    <div class="absolute bottom-1 right-1 flex gap-1">
                        <button onclick="downloadSingle('${src}', ${index})" class="bg-black/70 p-1 rounded text-[10px]">Save</button>
                        ${isAdmin ? `<button onclick="deletePhoto(${index})" class="bg-red-600 p-1 rounded text-[10px]">X</button>` : ''}
                    </div>
                `;
                gallery.appendChild(div);
            });
        }

        function deletePhoto(index) {
            photos.splice(index, 1);
            saveAndRender();
        }

        function clearGallery() {
            if(confirm("എല്ലാ ഫോട്ടോകളും കളയണോ?")) {
                photos = [];
                saveAndRender();
            }
        }

        async function downloadSingle(url, index) {
            const res = await fetch(url);
            const blob = await res.blob();
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `photo_${index+1}.jpg`;
            a.click();
        }

        function toggleQR() {
            const box = document.getElementById('qr-box');
            box.classList.toggle('hidden');
            if(!box.classList.contains('hidden')) {
                document.getElementById('qrcode').innerHTML = "";
                new QRCode(document.getElementById('qrcode'), {
                    text: window.location.origin + window.location.pathname,
                    width: 180, height: 180
                });
            }
        }

        async function downloadAllZip() {
            if(photos.length === 0) return alert("No photos!");
            const zip = new JSZip();
            for (let i = 0; i < photos.length; i++) {
                const res = await fetch(photos[i]);
                zip.file(`photo_${i+1}.jpg`, await res.blob());
            }
            const content = await zip.generateAsync({type:"blob"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(content);
            a.download = "gallery.zip";
            a.click();
        }
    </script>
</body>
</html>
