<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frames by Arju</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade { animation: fadeIn 2s ease-in-out; }
        .hidden { display: none; }
        .loader-spinner { border-top-color: #f97316; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-black text-white">

    <div id="loader" class="fixed inset-0 flex items-center justify-center bg-black z-50">
        <h1 class="text-3xl md:text-5xl font-bold animate-fade text-orange-500 tracking-tighter">FRAMES BY ARJU</h1>
    </div>

    <div id="app" class="hidden p-4">
        <header class="text-center mb-8">
            <h2 class="text-xl font-light tracking-widest uppercase">Gallery</h2>
            
            <div id="admin-panel" class="hidden mt-5 p-4 border border-dashed border-gray-600 rounded">
                <p class="text-xs text-gray-400 mb-2 font-bold">ADMIN PANEL</p>
                <div id="upload-status" class="hidden mb-2 text-orange-500 text-xs italic text-center">Uploading photos, please wait...</div>
                <input type="file" id="file-input" multiple accept="image/*" class="hidden">
                <button onclick="document.getElementById('file-input').click()" class="bg-white text-black px-4 py-2 rounded text-sm font-bold">ADD PHOTOS</button>
                <button id="qr-gen-btn" onclick="toggleQR()" class="bg-orange-600 px-4 py-2 rounded text-sm font-bold ml-2">GENERATE QR</button>
            </div>
        </header>

        <div id="qr-box" class="hidden bg-white p-4 rounded-lg mx-auto max-w-[250px] text-center mb-8">
            <div id="qrcode" class="flex justify-center"></div>
            <p class="text-black text-xs mt-2 font-bold uppercase">Scan to share this gallery</p>
        </div>

        <div id="user-controls" class="flex justify-between items-center mb-4">
            <span id="photo-count" class="text-xs text-gray-400">0 Photos</span>
            <button onclick="downloadAllZip()" class="bg-green-600 text-[10px] px-3 py-1 rounded-full uppercase font-bold">Download All (ZIP)</button>
        </div>

        <div id="gallery" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
    </div>

    <script>
        // --- ക്ലൗഡിനറി സെറ്റിംഗ്സ് (ഇവിടെ മാറ്റം വരുത്തുക) ---
        const CLOUD_NAME = "dlgrj339z"; // Cloudinary Cloud Name നൽകുക
        const UPLOAD_PRESET = "Aj wedding"; // 'Unsigned' പ്രീസെറ്റ് നെയിം നൽകുക
        // -------------------------------------------

        let photos = [];
        const urlParams = new URLSearchParams(window.location.search);
        const isAdmin = urlParams.get('admin') === 'true';

        setTimeout(() => {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('app').classList.remove('hidden');
            if(isAdmin) document.getElementById('admin-panel').classList.remove('hidden');
        }, 2500);

        // ഫയലുകൾ അപ്‌ലോഡ് ചെയ്യാനുള്ള ഫംഗ്‌ഷൻ
        document.getElementById('file-input').addEventListener('change', async function(e) {
            const files = Array.from(e.target.files);
            if(files.length === 0) return;

            const status = document.getElementById('upload-status');
            status.classList.remove('hidden');

            for (const file of files) {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', UPLOAD_PRESET);

                try {
                    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    const data = await response.json();
                    if(data.secure_url) {
                        photos.push(data.secure_url);
                        renderGallery();
                    }
                } catch (err) {
                    console.error("Upload error:", err);
                }
            }
            status.classList.add('hidden');
        });

        function renderGallery() {
            const gallery = document.getElementById('gallery');
            const count = document.getElementById('photo-count');
            gallery.innerHTML = "";
            count.innerText = `${photos.length} Photos`;

            photos.forEach((src, index) => {
                const div = document.createElement('div');
                div.className = "relative group aspect-square rounded-lg overflow-hidden bg-gray-900 shadow-lg";
                div.innerHTML = `
                    <img src="${src}" class="w-full h-full object-cover cursor-pointer" onclick="previewImage('${src}')">
                    <div class="absolute bottom-1 right-1 flex gap-1">
                        <button onclick="downloadSingle('${src}', ${index})" class="bg-black/70 p-1 rounded text-[10px] text-white">Save</button>
                        ${isAdmin ? `<button onclick="deletePhoto(${index})" class="bg-red-600/80 p-1 rounded text-[10px]">X</button>` : ''}
                    </div>
                `;
                gallery.appendChild(div);
            });
        }

        function previewImage(src) {
            window.open(src, '_blank');
        }

        async function downloadSingle(url, index) {
            const response = await fetch(url);
            const blob = await response.blob();
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `photo_${index + 1}.jpg`;
            link.click();
        }

        function deletePhoto(index) {
            photos.splice(index, 1);
            renderGallery();
        }

        function toggleQR() {
            const qrBox = document.getElementById('qr-box');
            qrBox.classList.toggle('hidden');
            if(!qrBox.classList.contains('hidden')) {
                document.getElementById('qrcode').innerHTML = "";
                const shareUrl = window.location.origin + window.location.pathname;
                new QRCode(document.getElementById('qrcode'), { text: shareUrl, width: 180, height: 180 });
            }
        }

        async function downloadAllZip() {
            if(photos.length === 0) return alert("No photos to download");
            alert("Preparing ZIP file... please wait.");
            const zip = new JSZip();
            
            for (let i = 0; i < photos.length; i++) {
                const response = await fetch(photos[i]);
                const blob = await response.blob();
                zip.file(`photo_${i+1}.jpg`, blob);
            }

            const content = await zip.generateAsync({type:"blob"});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(content);
            link.download = "frames_by_arju_all.zip";
            link.click();
        }
    </script>
</body>
</html>
